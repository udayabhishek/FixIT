<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>Screen 3</title>

<!-- Bootstrap -->
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<link rel="stylesheet" href="css/font-awesome.css">
<script type="text/javascript"
	src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<!-- <script src="js/back_button_disable.js"></script> -->
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<!-- <div class="container"> -->
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="col-xs-7 col-sm-6 text-right"
			style="color: #fff; padding-top: 10px;">
			<h4>Post a Job</h4>
		</div>
		<div class="col-xs-5 col-sm-6  navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse"
				id="settings_button">
				<span class="sr-only">Toggle navigation</span> <span
					class="icon-bar"></span> <span class="icon-bar"></span> <span
					class="icon-bar"></span>
			</button>
			<!-- <a class="navbar-brand" href="#">Start Bootstrap</a> -->
		</div>
	</nav>
	<section style="margin-top: 75px; color: #000">
		<form autocomplete="on">
			<div class="container">
				<div class="form-group">
					<label for="Email1">What can we fix?<span>*</span></label>
					<textarea class="form-control" id="fix" rows="3"></textarea>
					<div id="errorBox_wecanfix" class="alertField"></div>
				</div>
				<div class="form-group" id="profile-image">
					<div class="row">
						<div class="col-xs-12 col-sm-12" style="padding-right: 5px;">
							<label for="exampleInputEmail1">Upload a photo</label>
						</div>
						<div class="col-xs-12 col-sm-12" style="padding-left: 5px;">
							<div class="col-xs-4 col-sm-4" id="profile-img">
								<div id="imagePreview1" class="img-rounded width"></div>
								<div class="uplload-button">
									<div id="deviceready">
										<p class="event listening" style="display: none;"></p>
										<p class="event received" style="display: none;"></p>
										<input type="file" id="selectedFile" name="selectedFile"
											style="display: none;" />
									</div>
								</div>
							</div>
							<div class="col-xs-4 col-sm-4" id="profile-img">
								<div id="imagePreview2" class="img-rounded width"></div>
								<div class="uplload-button">
									<div id="deviceready">

										<p class="event listening" style="display: none;"></p>
										<p class="event received" style="display: none;"></p>
										<input type="file" id="selectedFile" name="selectedFile"
											style="display: none;" />
									</div>
								</div>
							</div>
							<div class="col-xs-4 col-sm-4" id="profile-img">
								<div id="imagePreview3" class="img-rounded width"></div>
								<div class="uplload-button">
									<div id="deviceready">

										<p class="event listening" style="display: none;"></p>
										<p class="event received" style="display: none;"></p>
										<input type="file" id="selectedFile" name="selectedFile"
											style="display: none;" />
									</div>
								</div>
							</div>

						</div>
					</div>
					<div id="errorBox_image" class="alertField"></div>
				</div>
				<div class="form-group">
					<label for="exampleInputEmail1">How fast do you need help?</label>
					<div id="errorBox_profession" class="alertField"></div>
					<div class="btn-group" id="radio" style="width: 100%" role="group">
						<div class="col-xs-12 col-sm-4" id="radiolabels">
							<input type="radio" value="6" name="radio" id="fasthelp1"
								class="radio" /> <label for="fasthelp1">2-6 HOURS</label>
						</div>

						<div class="col-xs-12 col-sm-4" id="radiolabels">
							<input type="radio" value="24" name="radio" id="fasthelp2"
								class="radio" /> <label for="fasthelp2">WITH IN 24 HOURS</label>
						</div>

						<div class="col-xs-12 col-sm-4" id="radiolabels">
							<input type="radio" value="0" name="radio" id="fasthelp3"
								class="radio" /> <label for="fasthelp3">FLEXIBLE</label>
						</div>
					</div>
				</div>
				<!-- <div class="form-group">
          <label for="exampleInputEmail1">Problem Location</label>
          <input type="text" class="form-control" id="phoneNumber">
        </div> -->
				<div class="form-group">
					<div class="row">
						<div class="col-xs-6 col-sm-6">
							<label for="exampleInputEmail1">Problem Location</label>
						</div>
						<div class="col-xs-6 col-sm-6 text-right">
							<!-- <a href="changeLocationnew.html" style="color:#000"> -->
							<label for="exampleInputEmail1" id="Change_Location">Change?
								<span class="gpsicon"></span>
							</label>
							<!-- </a> -->
						</div>
						<div class="col-xs-12 col-sm-12">
							<p class="limited-paragraph" id="CurrentLocation"></p>
						</div>
					</div>
				</div>
			</div>

			<div class="modal-footer" id="button">
				<div class="btn-group btn-group-justified" role="group"
					aria-label="group button">
					<div class="btn-group" role="group">
						<button type="button" class="btn btn-default" role="button"
							onclick="slide6Details();">Let FixIt Pick</button>
					</div>
					<div class="btn-group" role="group">
						<button type="button" id="saveImage"
							class="btn btn-default btn-hover-green" data-action="save"
							role="button" onclick="slide3Details();">I'll Pick</button>
					</div>
				</div>
			</div>

		</form>
	</section>
<div class="modal fade" id="fixit_pick">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="ModelTopBorder"></div>
                  <div class="modal-body">
                      <p>Please be patient. You should expect a response soon.</p>
                  </div>
                  <div class="modal-footer" id="ModalButton">
                    <div class="btn-group btn-group-justified" role="group" aria-label="group button">
                      <div class="btn-group" role="group">
                        <button type="button" class="btn btn-default" role="button" data-backdrop="static" data-keyboard="false">OK</button>
                      </div> 
                    </div>
                </div> 
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->




	<div class="modal fade" id="map" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Change Location ?</h4>
				</div>
				<div class="modal-body" id="dvMap"
					style="width: 335px; height: 300px"></div>
				<div class="modal-footer"></div>

			</div>
		</div>
	</div>
	</div>
	<!--My Modal for Location Error-->
	<div class="modal fade" id="myModalForLocationError" role="dialog">
		<div class="modal-dialog">

			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Location Error</h4>
				</div>
				<div class="modal-body">
					<p id="locationerror"></p>
				</div>

			</div>
		</div>
	</div>

	<!--My Modal for Change Location-->
	<div class="modal fade" id="myModal" role="dialog">
		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Change Location ?</h4>
				</div>
				<div class="modal-body">
					<p id="location"></p>
				</div>
				<div class="modal-footer">
					<button type="button" id="change" class="btn btn-default"
						style="width: 335px" data-dismiss="modal">Change ?</button>
				</div>

			</div>
		</div>
	</div>


	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="js/jquery.min.js"></script>
	<script
		src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular.min.js"></script>
	<script src="http://code.ionicframework.com/1.0.1/js/ionic.min.js"></script>
	<script type="text/javascript" src="cordova.js"></script>
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="js/bootstrap.min.js"></script>

	<script type="text/javascript">
        window.onload = function(){
            sessionStorage.setItem("slide",slide3issue);
            getLocation();
        }
        
        
        
		var myFuncCalls = 0;
		function openFileBrowser(image_Preview) {
			//alert('$ is defined');       

			var serverpath = "";
			var imagepath = "";

			//alert('$ is defined');
			var deviceInformation = ionic.Platform.version(); //fetch the device operating system
			var currentPlatform = ionic.Platform.platform(); //fetch the device OS version
			var o = new Object();
			var app = {

				initialize : function() {
					this.bindEvents();
				},

				bindEvents : function() {
					document.addEventListener('deviceready',
							this.onDeviceReady, false);
				},

				onDeviceReady : function() {
					app.receivedEvent('deviceready');

				},

				receivedEvent : function(id) {
					var parentElement = document.getElementById(id);
					var listeningElement = parentElement
							.querySelector('.listening');
					var receivedElement = parentElement
							.querySelector('.received');

					listeningElement.setAttribute('style', 'display:none;');
					receivedElement.setAttribute('style', 'display:block;');

					console.log('Received Event: ' + id);

					function escapeShellArg(cmd) {
						return '\'' + cmd.replace(/\'/g, "'\\''") + '\'';
					}

					var success = function(data) {
						console.log(data.filepath);
						var fileURL = data.filepath;

						$("#" + image_Preview + "").css("background-image",
								"url(" + escapeShellArg(fileURL) + ")");

						var win = function(r) {
							console.log("Code = " + r.responseCode);
							console.log("Response = " + r.response);
							console.log("Sent = " + r.bytesSent);
							// $('#myModal').modal('show');
							serverpath = JSON.parse(r.response);
							imagepath = serverpath.path;
							myFuncCalls++;
							// alert("Count :"+myFuncCalls);
							//$('#myModal').modal('hide');
							//alert("Server path : "+serverpath.path);
							sessionStorage.setItem(
									'profileimage' + myFuncCalls,
									serverpath.path);

						}

						var fail = function(error) {
							//alert("An error has occurred: Code = " + error.code);
							console.log("upload error source " + error.source);
							console.log("upload error target " + error.target);
						}

						var options = new FileUploadOptions();

						options.fileKey = "fileToUpload";
						options.fileName = fileURL.substr(fileURL
								.lastIndexOf('/') + 1);
						options.mimeType = "image/jpg";

						var params = {};
						params.value1 = "test";
						params.value2 = "param";

						var ft = new FileTransfer();
						ft
								.upload(
										fileURL,
										encodeURI("http://in.shikshainfotech.com/FixIT/uploadjobphotos.php"),
										win, fail, options);

					};

					var error = function(msg) {
						console.log(msg);
					};

					filechooser.open({}, success, error);

				}//3rd bracket
			};//2nd bracket

			app.initialize();

		}//1st bracket
	</script>

	<script type="text/javascript">
		/*$(window).load(function(){
		    $('#myModal').modal('show');
		});*/
		var imagepath1 = "";
		var imagepath2 = "";
		var imagepath3 = "";

		$("#imagePreview1").on("click", function() {

			openFileBrowser('imagePreview1');

		});
		$("#imagePreview2").on("click", function() {

			openFileBrowser('imagePreview2');

		});
		$("#imagePreview3").on("click", function() {

			openFileBrowser('imagePreview3');

		});
	</script>

	<script type="text/javascript">
		var oid = localStorage.getItem('oid');
		var newDate = new Date();
		var day = getWeekDay(newDate);
		var hours = newDate.getHours();
		function slide3Details() {
			var wecanfixtext = document.getElementById("fix").value;

			var text = /^([0-9 _-]+)$/;
			var reg = /[-!$%^&*()_+|~=`\\#{}\[\]:";'<>?,.\/]/;
			if (!wecanfixtext) {
				document.getElementById("errorBox_wecanfix").innerHTML = "Please Enter your problem";
				return false;
			} else if ((text.test(wecanfixtext))) {
				document.getElementById("errorBox_wecanfix").innerHTML = "Please Enter valid text";
				return false;
			} else if ((reg.test(wecanfixtext))) {
				document.getElementById("errorBox_wecanfix").innerHTML = "Please Enter valid text";
				return false;
			} else {
				document.getElementById("errorBox_wecanfix").innerHTML = "";
			}

			//alert(wecanfixtext);

			var fasthelp = document.getElementsByName('radio');
			var help;
			for (var i = 0; i < fasthelp.length; i++) {
				if (fasthelp[i].checked) {
					help = fasthelp[i].value;

				}
			}
			//alert("how fast :"+help); 
			if (!help) {

				document.getElementById("errorBox_profession").innerHTML = "Select a range";
				//alert("Select atleast one hero");  
				return false;
			} else {
				document.getElementById("errorBox_profession").innerHTML = "";
			}
			imagepath1 = sessionStorage.getItem('profileimage1');
			//alert("ImagePath1 :"+imagepath1);
			sessionStorage.removeItem('profileimage1');
			imagepath2 = sessionStorage.getItem('profileimage2');
			//alert("ImagePath2 :"+imagepath2);
			sessionStorage.removeItem('profileimage2');
			imagepath3 = sessionStorage.getItem('profileimage3');
			//alert("ImagePath3 :"+imagepath3);
			sessionStorage.removeItem('profileimage3');
			var image_paths = imagepath1 + "," + imagepath2 + "," + imagepath3;

			//alert(image_paths);
			var valid_extensions = /(.jpg|.jpeg|.png)$/i;

			var paragraphs = document.getElementsByTagName("p");
			var userlocation = paragraphs[6].innerHTML;
			// alert(userlocation);
			var address = new Array();
			address = userlocation.split(",");
			var zipcode = address[3];
			var pin_arr = zipcode.split(" ");
			var pincode = pin_arr[2];
			// alert(pincode);
			sessionStorage.setItem('pin', pincode);
			getKindOfwork();
			//sessionStorage.setItem('jid',jid);
			window.location = "slide4.html";

			sessionStorage.setItem('wecanfixtext', wecanfixtext);
			sessionStorage.setItem('image_paths', image_paths);
			sessionStorage.setItem('help', help);
			sessionStorage.setItem('userlocation', userlocation);
			
		}

		function slide6Details() 
		{
			
            var creditcard_number=sessionStorage.getItem('creditcard_number');
			//alert("creditcard_number "+creditcard_number );
			var wecanfixtext = document.getElementById("fix").value;
			var text = /^([0-9 _-]+)$/;
			var reg = /[-!$%^&*()_+|~=`\\#{}\[\]:";'<>?,.\/]/;
			if (!wecanfixtext) {
				document.getElementById("errorBox_wecanfix").innerHTML = "Please Enter your problem";
				return false;
			} else if ((text.test(wecanfixtext))) {
				document.getElementById("errorBox_wecanfix").innerHTML = "Please Enter valid text";
				return false;
			} else if ((reg.test(wecanfixtext))) {
				document.getElementById("errorBox_wecanfix").innerHTML = "Please Enter valid text";
				return false;
			} else {
				document.getElementById("errorBox_wecanfix").innerHTML = "";
			}
			//alert(wecanfixtext);
			var fasthelp = document.getElementsByName('radio');
			var help;
			for (var i = 0; i < fasthelp.length; i++) {
				if (fasthelp[i].checked) {
					help = fasthelp[i].value;

				}
			}

			//alert("how fast :"+help); 
			if (!help) {

				document.getElementById("errorBox_profession").innerHTML = "Select a range";
				//alert("Select atleast one hero");  
				return false;
			} else {
				document.getElementById("errorBox_profession").innerHTML = "";
			}
			imagepath1 = sessionStorage.getItem('profileimage1');
			//alert("ImagePath1 :"+imagepath1);
			sessionStorage.removeItem('profileimage1');
			imagepath2 = sessionStorage.getItem('profileimage2');
			//alert("ImagePath2 :"+imagepath2);
			sessionStorage.removeItem('profileimage2');
			imagepath3 = sessionStorage.getItem('profileimage3');
			//alert("ImagePath3 :"+imagepath3);
			sessionStorage.removeItem('profileimage3');
			var image_paths = imagepath1 + "," + imagepath2 + "," + imagepath3;
			var paragraphs = document.getElementsByTagName("p");
			var userlocation = paragraphs[6].innerHTML;
			var address = new Array();
			address = userlocation.split(",");
			var zipcode = address[3];
			var pin_arr = zipcode.split(" ");
			var pincode = pin_arr[2];
			sessionStorage.setItem("pincode",pincode);
			var data = sessionStorage.getItem('data');
			var newDate = new Date();
			var day = getWeekDay(newDate);
			var hours = newDate.getHours();
			sessionStorage.setItem('wecanfixtext', wecanfixtext);
			sessionStorage.setItem('image_paths', image_paths);
			sessionStorage.setItem('help', help);
			sessionStorage.setItem('userlocation', userlocation);
			sessionStorage.setItem('pick', 'fixit');

			if(creditcard_number=="null")
			{
				//alert("i am in if block");
				window.location="credit_card_details.html";
			}
			else 
			{
			
			//alert("slide3 oid is: "+ oid);
			//alert("details are : "+ oid+" "+ wecanfixtext +" "+image_paths+" "+help+" "+userlocation);
			 //alert("work flow is: " +data +" "+ pincode+ " "+day+" "+hours);
			$.ajax({
				type : "POST",
				url : "http://in.shikshainfotech.com/FixIT/postajob.php?",
				data : 'oid='+oid+'&issue='+wecanfixtext+'&photo='
						+image_paths+'&howfast='+help+'&location='
						+userlocation+'&pick=fixit&kindOfWork='+data
						+'&zipcode='+pincode+'&day='+day+'&time='
						+hours,
				success : function(data) {
					//alert("data is : "+ data);
					//alert("data length is: "+data.length);
					var jsdata_str = JSON.stringify(data);
					var jsdata_obj = JSON.parse(jsdata_str);
					var jid = jsdata_obj.jid;
					// alert("jid is :" + jid);
					sessionStorage.setItem('jid', jid);
					$('#fixit_pick').modal({backdrop: 'static', keyboard: false});
					//window.location = "slide6.html";
				},
				error : function(jqXHR, textStatus, errorThrown) {
					alert('Error' + errorThrown + textStatus + jqXHR);
					//window.location="slide4.html";
				}
			});
			
			}
		}

		function getWeekDay(date) {
			var days = [ '1', '2', '3', '4', '5', '6', '7' ]
			return days[date.getDay()]
		}
	</script>

	<script type="text/javascript">
	var newlocation = "";
    function getLocation() {

      newlocation = sessionStorage.getItem('NewLocation');
      //alert("newLocation :"+newlocation);
      if(newlocation == null)
      {
        //alert("geolocation called..");
         if (navigator.geolocation) {
             navigator.geolocation.getCurrentPosition(showPosition, showError,{timeout: 10000, enableHighAccuracy: true});
         } else {
           //alert("Geolocation is not supported by this browser.");
             x.innerHTML = "Geolocation is not supported by this browser.";
         }
      }
      else if(newlocation != null)
      {
    	  //alert("newLocation :"+newlocation);
          $('#CurrentLocation').text(newlocation);
      }
     
    
    }

		function showPosition(position) {
			var lat = position.coords.latitude;
			var lng = position.coords.longitude;

			//alert(lat+' ; '+lng);
			GetAddress(lat, lng);

		}

		function showError(error) {
			//alert(error);
			switch (error.code) {
			case error.PERMISSION_DENIED:
				alert("User denied the request for Geolocation.");
				//x.innerHTML = "User denied the request for Geolocation."
				break;
			case error.POSITION_UNAVAILABLE:
				alert("Location information is unavailable.");
				//x.innerHTML = "Location information is unavailable."
				break;
			case error.TIMEOUT:
				//alert("The request to get user location timed out.");
				$('#myModalForLocationError').modal('show');
				$('#locationerror')
						.text(
								"The request to get user location timed out.Please check your gps sttings");
				//x.innerHTML = "The request to get user location timed out."
				break;
			case error.UNKNOWN_ERROR:
				alert("An unknown error occurred.");
				// x.innerHTML = "An unknown error occurred."
				break;
			}
		}
		function GetAddress(lat, lng) {

			var latlng = new google.maps.LatLng(lat, lng);
			var geocoder = geocoder = new google.maps.Geocoder();
			geocoder.geocode({
				'latLng' : latlng
			}, function(results, status) {
				if (status == google.maps.GeocoderStatus.OK) {
					if (results[1]) {

						$('#CurrentLocation')
								.text(results[1].formatted_address);
						/*if(sessionStorage.getItem('changedLocation')!=null)
						{
						
						 $('#CurrentLocation').text(sessionStorage.getItem('changedLocation'));
						}*/

					}
				}
			});
		}
	</script>

	<script type="text/javascript">
		/* $("#Change_Location").on("click", function() {
			$('#map').modal('show');
			// alert("Get new Location Called");
			getNewLocation();
		});
 */
		function getNewLocation() {
			//$('#myModalView').modal('show');
			if (navigator.geolocation) {

				navigator.geolocation.getCurrentPosition(showPositionNew,
						showErrorNew);
				//$('#myModalView').modal('hide');
			} else {
				x.innerHTML = "Geolocation is not supported by this browser.";
			}
		}

		function showPositionNew(position) {
			var lat = position.coords.latitude;
			var lng = position.coords.longitude;
			var map;

			var mapOptions = {
				center : new google.maps.LatLng(lat, lng),
				zoom : 14,
				mapTypeId : google.maps.MapTypeId.ROADMAP
			};
			var infoWindow = new google.maps.InfoWindow();
			var latlngbounds = new google.maps.LatLngBounds();
			var map = new google.maps.Map(document.getElementById("dvMap"),
					mapOptions);

			marker = new google.maps.Marker({
				draggable : true,
				animation : google.maps.Animation.DROP,
				position : new google.maps.LatLng(lat, lng),
				map : map,
			});

			google.maps.event.addListener(marker, 'dragend', function() {

				var latlng = new google.maps.LatLng(marker.position.lat(),
						marker.position.lng());
				var geocoder = geocoder = new google.maps.Geocoder();
				geocoder.geocode({
					'latLng' : latlng
				}, function(results, status) {
					if (status == google.maps.GeocoderStatus.OK) {

						if (results[1]) {
							$('#myModal').modal('show');
							$('#location').text(results[1].formatted_address);
							$("#change").on(
									"click",
									function() {
										$('#map').modal('hide');
										$('#CurrentLocation').text(
												results[1].formatted_address);
										//sessionStorage.setItem('changedLocation',results[1].formatted_address);
										//window.location="slide3.html"

									});

						}
					}
				});
			});

			/*var img_url = "http://maps.googleapis.com/maps/api/staticmap?center="
			+latlon+"&zoom=14&size=400x300&sensor=false";
			document.getElementById("mapholder").innerHTML = "<img src='"+img_url+"'>";*/
		}

		function showErrorNew(error) {
			switch (error.code) {
			case error.PERMISSION_DENIED:
				x.innerHTML = "User denied the request for Geolocation."
				break;
			case error.POSITION_UNAVAILABLE:
				x.innerHTML = "Location information is unavailable."
				break;
			case error.TIMEOUT:
				x.innerHTML = "The request to get user location timed out."
				break;
			case error.UNKNOWN_ERROR:
				x.innerHTML = "An unknown error occurred."
				break;
			}
		}
	</script>
	<script type="text/javascript">
		function getKindOfwork() {

			var data = sessionStorage.getItem('data');
			if (data == '1') {
				sessionStorage.setItem('kindofwork', data);

			} else if (data == '2') {
				sessionStorage.setItem('kindofwork', data);

			}

			else if (data == '3') {
				sessionStorage.setItem('kindofwork', data);

			} else {
				alert("u r not getting anything");
			}

		}

		$("#settings_button").click(function() {

			// sessionStorage.setItem('oid',oid);

			window.location = "slide28.html";
		});
		
		  $("#Change_Location").on("click", function()
		          {
		            //$('#map').modal('show');
		            window.location="GooglePlacesAutocomplete.html";
		            // getNewLocation();
		            //var loc = sessionStorage.getItem('NewLocation');
		            //alert("Loc :"+loc);
		            //$('#CurrentLocation').text(loc);
		          });
	</script>
</body>
</html>