<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Screen 31</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="css/font-awesome.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body onload="fillpage()">


<nav class="navbar navbar-inverse navbar-top" role="navigation">

    <div class="col-xs-2 col-sm-2 text-left"
        style="color: #fff;  padding: 10px 0 0 10px  ; ">
        <button type="button" class="navbar-toggle" data-toggle="collapse"
            id="back-button-id" >
            <i class="fa fa-chevron-left"></i>
        </button>
    </div>
    <div class="col-xs-8 col-sm-8 text-center"
        style="color: #fff; padding-top: 15px;">
        <h4>Fixit</h4>
    </div>
    <div class="col-xs-2 col-sm-2  navbar-header text-right" style="padding-top: 10px;">
<!--        <button type="button" class="navbar-toggle" data-toggle="collapse"-->
<!--            id="settings_button">-->
<!--            <span class="sr-only">Toggle navigation</span> <span-->
<!--                class="icon-bar"></span> <span class="icon-bar"></span> <span-->
<!--                    class="icon-bar"></span>-->
<!--        </button>-->
<!--       -->
    </div>
</nav>


    <section style="color:#000" id="slide30">
      <form name="form31" id="form31">
      <div class="container" id="">
          <div class="form-group" id="profile-image" >
              <div class="row">
                <div class="col-xs-4 col-sm-4">
                     <div id="imagePreview" class="img-circle img-H-W"
                     data-toggle="modal" data-target="#imgPreview"></div>
                </div>
              <div class="uplload-button">
                <div id="deviceready">
                
                <p class="event listening" style="display: none;"></p>
                <p class="event received" style="display: none;"></p>
                  <input type="file" id="selectedFile"
                    name="selectedFile" style="display: none;" />
                </div>
                <!-- <input type="button" id="uploadFile" value="Browse"  class="img"/>-->
              </div>   
                <div class="col-xs-8 col-sm-8">
                    <div class="row" id="name">
                        <div class="col-sm-12 col-md-12 col-xs-12"><input type="text" class="form-control" id="firstname" placeholder="First name" value="" name="FirstName"
                          onkeyup="this.value=this.value.replace(/[^a-zA-Z ]/g,'');"
                          onchange="return validateFirstName();"disabled>
                          <div id="errorBox_firstname" class="alertField"></div>
                        </div>
                        <div class="col-sm-12 col-md-12 col-xs-12"><input type="text" class="form-control" id="lastname" placeholder="Last Name" value="" name="LastName" onkeyup="this.value=this.value.replace(/[^a-zA-Z ]/g,'');" onchange="return validateLastName();" disabled>
                          <div id="errorBox_lastname" class="alertField"></div>
                        </div>
                    </div>
                </div>            
              </div>
              <div class="form-group">
                <label for="email1">Email address</label>
                <input type="email" class="form-control" id="emailid" name="EmailId" placeholder="sample@gmail.com" value="" onchange="return validateEmailId();" disabled>
                <div id="errorBox_email_id" class="alertField"></div>

              </div>
              <div class="form-group">
                <label for="phone">Password</label>
                <input type="password" class="form-control" id="password" placeholder="*******" value="" disabled>
              </div>
              <div class="form-group">
                <label for="phone">Phone</label>
                <input type="tel" class="form-control" id="phoneNumber" name="PhoneNo" placeholder="9876541230" value="" onblur="return validatePhoneNumber();" disabled>
                <div id="errorBox_phoneno" class="alertField"></div>
              </div>
              <div class="form-group">
					<label for="exampleInputPassword1">Countries</label> 
					<select id="countries" name="country" class="form-control"  onchange="return validatecountry();" disabled></select>
					<div id="errorBox_country" class="alertField"></div>
				</div> 
				<div class="form-group">
					<label for="exampleInputEmail1">Address</label> <input
						type="text" name="address" class="form-control" id="address" value=""
						onchange="return validateAddress();" disabled>

					<div id="errorBox_address" class="alertField"></div>
				</div>
				<div class="form-group">
					<div class="row">
						<div class="col-xs-6 col-sm-6">
							<label for="exampleInputEmail1">City
							</label> <input type="text"
								name="city" class="form-control" id="city" value="" disabled>
						</div>
						<div class="col-xs-6 col-sm-6">
							<label for="exampleInputPassword1">State</label> <select
								name="state" id="states" class="form-control" disabled>
								
							</select>
						</div>
					</div>
					<div id="errorBox_city" class="alertField"></div>
				</div>
				<div class="form-group">
					<label for="exampleInputEmail1">Zip Code</label>
					  <input type="number" name="zcode" class="form-control" id="zipcode" value="" onkeypress="if(this.value.length>5){this.value='this.value';}"  onblur="return validateZipcode();" disabled>
					<div id="errorBox_Zipcode" class="alertField"></div>
				</div>
              
        </div>        
      </div>
          
        <div class="modal-footer navbar-bottom" id="button">
            <div class="btn-group btn-group-justified" role="group" aria-label="group button">
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-default" role="button" id="edit">Edit</button>
              </div>
              <div class="btn-group" role="group">
                <button type="button" id="save" class="btn btn-default btn-hover-green" data-action="save" role="button" data-toggle="modal">Save</button>
           
              </div> 
            </div>
        </div>
          
      </form>
    </section>
    
<!-- --------------Modal POPUP starts-------------   -->

<div class="modal fade" id="success">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="ModelTopBorder text-center">
                <h4 style="background-color: #ccc;margin: 0px;padding: 25px 0px;">Title</h4>
            </div>
            
            <div class="modal-footer" id="ModalButton">
                <div class="btn-group btn-group-justified" role="group" aria-label="group button">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-default ok-btn" role="button" data-dismiss="modal">ok</button>
                    </div>
                </div>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<!-----------------Modal Popup Ends-------------------->


<!------------------Profile image Modal popup starts----------->
<div class="modal fade" id="imgPreview">
    <div class="modal-dialog">
        <div class="modal-content text-center">
            <div class="ModelTopBorder">
                <h4 style="background-color: #ccc;margin:0px;padding: 10px 0px;">Complete Action Using
                </h4>
            </div>
            <div class="modal-body text-center">
                <div class="row">
                    <div class="col-sm-6 col-xs-6" >
                        <div class="text-center" id="camera_option">
                            <div>
                                <i class="fa fa-camera fa-5x"></i>
                            </div>
                            <div>
                                <label>Camera</label>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xs-6">
                        <div class="text-center" id="gallery_option">
                            <div>
                                <i class="fa fa-picture-o fa-5x"></i>
                            </div>
                            <div id="deviceready">
                                <p class="event listening" style="display: none;">
                                
                                </p>
                                <p class="event received" style="display: none;">
                                
                                </p>
                            </div>
                            <div>
                                <label>Gallery</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>                      
            <div class="modal-footer" id="ModalButton">
                <div class="btn-group btn-group-justified" role="group" aria-label="group button">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-default" role="button" data-dismiss="modal">CANCEL
                        </button>
                    </div>
                </div>
            </div> 
        </div>
    </div>


<!------------------Profile image modal popup ends-->

<div class="modal fade" id="success">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="ModelTopBorder text-center">
                <h4 style="background-color: #ccc;margin: 0px;padding: 25px 0px;">Title</h4>
            </div>
            
            <div class="modal-footer" id="ModalButton">
                <div class="btn-group btn-group-justified" role="group" aria-label="group button">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-default ok-btn" role="button" data-dismiss="modal">ok</button>
                    </div>
                </div>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<!--    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular.min.js"></script>-->
<!--    <script src="http://code.ionicframework.com/1.0.1/js/ionic.min.js"></script>-->

    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/ionic.min.js"></script>
    <script type="text/javascript" src="js/internet_connection.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script>
        window.unload = function(){
           // alert("unload");
          //  $("#success").modal('hide');
        }
        
        
        $("#back-button-id").click(function(){
                     
                //window.location.href="slide28.html";
                         window.history.go(-1);
                               //    alert("qw");
                                   $("#success").modal('show');
        });
        
      $(function() {
          $("#selectedFile").on("change", function()
          {
              var files = !!this.files ? this.files : [];
              if (!files.length || !window.FileReader) return; // no file selected, or no FileReader support
       
              if (/^image/.test( files[0].type)){ // only image file
                  var reader = new FileReader(); // instance of the FileReader
                  reader.readAsDataURL(files[0]); // read the local file
       
                  reader.onloadend = function(){ // set image data as background of div
                      $("#imagePreview").css("background-image", "url("+this.result+")");
                  }
              }
          });
      });
      
      
      
      
    </script>

    <script type="text/javascript">


        function fillpage()
        {
            var imageURL = "http://in.shikshainfotech.com/FixIT/uploads/houseowner-profile-images/";

            var new_email = sessionStorage.getItem('new_email');
            var new_fname = sessionStorage.getItem('new_fname');
            var new_lname = sessionStorage.getItem('new_lname');
            var new_phone = sessionStorage.getItem('new_phone');
            var new_password = sessionStorage.getItem('new_password');
            var new_countries=sessionStorage.getItem('new_countries');
	        var new_address=sessionStorage.getItem('new_address');
	        var new_city=sessionStorage.getItem('new_city');
	        var new_states=sessionStorage.getItem('new_states');
	        var new_zipcode=sessionStorage.getItem('new_zipcode');
			//alert("new_email :"+new_email);
            if(new_email==null)
            {
               var emailid = localStorage.getItem('$email');
               $("#emailid").val(emailid);
            }
            else 
            {
               $("#emailid").val(new_email);
            }
            if(new_fname==null)
            {
               var firstname = localStorage.getItem('firstname');
               $("#firstname").val(firstname);
            }
            else 
            {
               $("#firstname").val(new_fname);
            }
            if(new_phone==null)
            {
               var phoneNumber = sessionStorage.getItem('phone');
               $("#phoneNumber").val(phoneNumber);
            }
            else 
            {
               $("#phoneNumber").val(new_phone);
            }
            if(new_password==null)
            {
               var password = localStorage.getItem('$password');
               $("#password").val(password);
            }
            else 
            {
               $("#password").val(new_password);
            }
            //alert("new lname: "+ new_lname);
            if(new_lname==null)
            {
               var lastname = sessionStorage.getItem('lastname');
               //alert("if_lastname: "+lastname);
               $("#lastname").val(lastname);
            }
            else 
            {
               // alert("else_lastname"+lastname);
               $("#lastname").val(new_lname);
            }
            if(new_countries==null)
            {
               var countries = sessionStorage.getItem('countries');
               $("#countries").val(countries);
            }
            else 
            {
               $("#countries").val(new_countries);
            }
            
            if(new_address==null)
            {
               var address = sessionStorage.getItem('address');
               $("#address").val(address);
            }
            else 
            {
               $("#address").val(new_address);
            }
			
            if(new_city==null)
            {
               var city = sessionStorage.getItem('city');
               $("#city").val(city);
            }
            else 
            {
               $("#city").val(new_city);
            }
            
            if(states==null)
            {
               var states = sessionStorage.getItem('state');
               $("#states").val(states);
            }
            else 
            {
               $("#states").val(new_states);
            }
            if(zipcode==null)
            {
               var zipcode = sessionStorage.getItem('zipcode');
               $("#zipcode").val(zipcode);
            }
            else 
            {
               $("#zipcode").val(new_zipcode);
            }
            
            
            var profileImage = sessionStorage.getItem('homeownerimage');
           // alert(" profileImage "+profileImage);
            sessionStorage.setItem('homeowner_profilepic', profileImage);
            var image=imageURL+profileImage;
           // alert(image);
               function escapeShellArgs (cmd) {
                return '\'' + cmd.replace(/\'/g, "'\\''") + '\'';
              }
            $("#imagePreview").css("background-image", "url("+escapeShellArgs(image)+")");
   

        }

        function enableFields()
        {
/*
            document.getElementById("email").disabled=true;
            document.getElementById("pwd").disabled=true;
            document.getElementById("check1").disabled=true;*/
            $("#emailid").removeAttr('disabled');
            $("#phoneNumber").removeAttr('disabled');
            $("#password").removeAttr('disabled');
            $("#lastname").removeAttr('disabled');
            $("#firstname").removeAttr('disabled');
            $("#countries").removeAttr('disabled');
            $("#address").removeAttr('disabled');
            $("#city").removeAttr('disabled');
            $("#states").removeAttr('disabled');
            $("#zipcode").removeAttr('disabled');
            


        }

            function validateFirstName() 
    {
      
      
     var regx = /^[A-Za-z][-a-zA-Z ]+$/;
     
     var fname=document.getElementById('firstname').value;
    
      
   if( fname == "" )
     {
     document.FirstName.FirstName.focus() ;
   
     document.getElementById("errorBox_firstname").innerHTML = "Enter first name";
     return false;
     }
  
  
   else if(fname.length < 3 || fname.length > 51 )
     {
          document.FirstName.FirstName.focus() ;
        // alert("Enter First Name");
         document.getElementById("errorBox_firstname").innerHTML = "First name must contain 3 to 50 character";
         return false;
     }
   else if(!regx.test(fname))
     {
         document.FirstName.FirstName.focus() ;
      //  alert("Enter First Name");
         document.getElementById("errorBox_firstname").innerHTML = "First name must contains character only.";
         return false;
     }
   
   else
     {
     
         document.getElementById("errorBox_firstname").innerHTML="" ;
     }
       return true;

    }

      //Validation for last name
    function validateLastName() 
    {
         var regx = /^[A-Za-z][-a-zA-Z]+$/;
         var lname=document.getElementById('lastname').value;
        
     if( lname == "" )
       {
      document.form31.LastName.focus();
       //  alert("Enter First Name");
      document.getElementById("errorBox_lastname").innerHTML = "Enter Last name";
           return false;
       }
    
    
     else if(lname.length < 2 || lname.length > 51 )
       {
           document.form31.LastName.focus();
       //  alert("Enter First Name");
           document.getElementById("errorBox_lastname").innerHTML = "Last name must contain 2 to 50 character";
           return false;
       }
     else if(!regx.test(lname))
       {
           document.form31.LastName.focus();
      //  alert("Enter First Name");
           document.getElementById("errorBox_lastname").innerHTML = "Last name must contains character only.";
           return false;
       }
     
     else
       {
       
           document.getElementById("errorBox_lastname").innerHTML=""  ;
       }
         return true;
    }

        //validate Email id
    function validateEmailId() 
    {
       var email=document.getElementById('emailid').value;
       var emailRegex = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
      
       if (email == "" )
          {
              document.form31.EmailId.focus();
            document.getElementById("errorBox_email_id").innerHTML = "Enter Email ID";
            return false;
          }
       else if(!emailRegex.test(email))
          {
              document.form31.EmailId.focus();
            document.getElementById("errorBox_email_id").innerHTML = "Enter  Valid Email ID";
            return false;
          }
      
       return true;
    }

            //Validate Phone number 
    function validatePhoneNumber() 
    {
       var phone=document.getElementById('phoneNumber').value;
    
       var stripped = phone.replace(/[\.\@\!\#\$\%\^\&\*\=\|\ ]/g, '');
       var isValid = /(^\d{5}$)|(^\d{5}-\d{4}$)/;
       
          
      if(phone == "")
     {
           document.form31.PhoneNo.focus();
             //alert("Enter Phone Number");
             document.getElementById("errorBox_phoneno").innerHTML = "Enter Mobile number";
             return false;
       }
    
   else if (isNaN(parseInt(stripped)))
     {
               //alert("stripped : " + stripped); 
          document.getElementById("errorBox_phoneno").innerHTML = "The phone number contains illegal characters.Don't include dash (-)\n";
            return false;
      } 
   else if (!(stripped.length >= 10 && stripped.length < 14  )) 
      {
              document.getElementById("errorBox_phoneno").innerHTML= "Enter correct phone number";
                return false;
      }
 
         
       else
      {

           document.getElementById("errorBox_phoneno").innerHTML="" ;
          
      }
       return true;
    }
    function validatecountry()
    {
    	var list1 = document.getElementById('countries');
        var country = list1.options[list1.selectedIndex].value;
        if(country =="")
        {
        	  document.getElementById("errorBox_country").innerHTML="Select Country";
         	  return false;
        }
        else
        {
        	 document.getElementById("errorBox_country").innerHTML = "";
        }
        return true;
    } 
    	  function validateAddress()
    	  {
    		  var address= document.myform.address.value;
    		  var regex=/^[a-z0-9]+$/i;
    		  if(address == "")
    		  {
    			  //document.myform.address.focus();
    			  document.getElementById("errorBox_address").innerHTML = "Enter Your Address";
    			  return false;
    		  }
    		  else if(address.length < 10 || address.length > 255)
    		  {
    			  document.getElementById("errorBox_address").innerHTML = "Address must contain 10 to 255 characters ";
    			  return false;
    		  }
    		 /*  else if(!regex.test(address))
    		  {
    			  document.getElementById("errorBox_address").innerHTML = "Enter Valid Address.";
    			  return false;
    		  } */
    		  else
    		  {
    			  document.getElementById("errorBox_address").innerHTML = "";
    		  }
    		  return true;
    		  
    		  
    	  }
    	  function validatecity()
    	  {
    		  var city = document.myform.city.value;
    		  if(city == "")
    		  {
    			  document.myform.city.focus();
    			  document.getElementById("errorBox_city").innerHTML = "Enter city";
    			  return false;
    		  }
    		  else
    		  {
    			  document.getElementById("errorBox_city").innerHTML = " ";
    		  }
    		  return true;
    	  }
    	  function validateZipcode() 
    	    {
    			var zipcode=document.myform.zcode.value;
    			var isValid = /(^\d{5}$)|(^\d{5}-\d{4}$)/;
    		    
    			  if(zipcode.length < 5 || zipcode.length > 6)
    			  {
    				document.getElementById("errorBox_Zipcode").innerHTML = "Enter valid  Zipcode";
    			    return false; 
    			  }
    			  else if(zipcode =="")
    			  {
    				  document.getElementById("errorBox_Zipcode").innerHTML = "Enter Zipcode";
    				   return false; 
    			  }
    			 else
    			  {
    				document.getElementById("errorBox_Zipcode").innerHTML = "";
    			  }
    			
    		  	return true;
    		}
    		
   	 	  
        $("#edit").click(function(){
            
            enableFields();

        });

        $("#save").click(function(){

           var oid=sessionStorage.getItem('owner');
           var email=document.getElementById('emailid').value;
           var fname=document.getElementById('firstname').value;
           var lname=document.getElementById('lastname').value;
           var phone=document.getElementById('phoneNumber').value;
           var password=document.getElementById('password').value;
           var countries=document.getElementById('countries').value;
           var address=document.getElementById('address').value;
           var city=document.getElementById('city').value;
           var states=document.getElementById('states').value;
           var zipcode=document.getElementById('zipcode').value;  
           	  sessionStorage.setItem('new_email',email);
	          sessionStorage.setItem('new_fname',fname);
	          sessionStorage.setItem('new_lname',lname);
	          sessionStorage.setItem('new_phone',phone);
	          sessionStorage.setItem('new_password',password);
	          sessionStorage.setItem('new_countries',countries);
	          sessionStorage.setItem('new_address',address);
	          sessionStorage.setItem('new_city',city);
	          sessionStorage.setItem('new_states',states);
	          sessionStorage.setItem('new_zipcode',zipcode);
	          //alert('oid='+oid+'&fname='+fname+'&lname='+lname+'&email='+email+'&phone='+phone+'&password='+password+'&countries='+countries+'&address='+address+'&city='+city+'&states='+states+'&zipcode='+zipcode);
            $.ajax({    //create an ajax request to load_page.php
            type: "POST",
            url: "http://in.shikshainfotech.com/FixIT/houseownerprofileupdate.php?",  
            data:'oid='+oid+'&fname='+fname+'&lname='+lname+'&email='+email+'&phone='+phone+'&password='+password+'&countries='+countries+'&address='+address+'&city='+city+'&states='+states+'&zipcode='+zipcode,    
            success: function(response){                    
 
                var json_arr=JSON.stringify(response);
                var obj = JSON.parse(json_arr);
               //alert("Obj :"+json_arr);
                   
           
                   $("#success h4").text("Saved Successfully");
                   $("#success").modal('show');
                   //window.location = "slide28.html";
             window.location = "slide28.html";
                /* if(obj[0].firstName==undefined)
                {
                  document.getElementById("errorBox_alertdata").innerHTML = json_arr;
                  return false;
                }
                else
                {
                 for(var i=0; i<obj.length; i++)
                  {
                  sessionStorage.setItem('oid', obj[0].oid);
                  sessionStorage.setItem('firstname', obj[0].firstName);
                  sessionStorage.setItem('lastname', obj[0].lastName);
                  sessionStorage.setItem('phone', obj[0].phone);
                  //sessionStorage.setItem('homeowner_profilepic', obj[0].profilepic);
                  //alert(obj[0].profilepic);
                  alert("Successfully Modified.");
                  //alert("firstname is : " + data[0].firstName);
                  window.location = "slide2.html";
                  }
                } */
           }

        });

        });

         //   $("#settings_button").click( function()
         //      {
                             
         //      window.location="slide28.html";
         //      }
         //   );

    </script>
   <script type="text/javascript" src="js/Countries.js"></script>
    <script type="text/javascript">
        var status;
        populateCountries("countries","states");
        $(".ok-btn").click(function(){
                    $("#success").modal('hide');
        });
	</script>
    <script>
        
    $("#camera_option").click(function(){
                $('#imgPreview').modal('hide');
            capturePhoto();
    });
                                  
    $("#gallery_option").click(function(){
                                                             
            $('#imgPreview').modal('hide');
            openFileBrowser();
                                                             
    });
                              
    function onFail(message) {
            $("#success h4").text('Failed because: ' + message);
            $("#success").modal('show');
        //alert('Failed because: ' + message);
    }
                              
    function capturePhoto() {
                             
        navigator.camera.getPicture(onPhotoDataSuccess, onFail, { quality: 50,
                                    destinationType: Camera.DestinationType.FILE_URI,
                                    correctOrientation: true,
                                    targetWidth: 320,
                                    targetHeight: 320
        });
                        
    }
                              
    function openFileBrowser()
    {
                             // sessionStorage.setItem('ImageId',imag);
        navigator.camera.getPicture(onPhotoDataSuccess, onFail, {
                            quality: 50,
                            destinationType: Camera.DestinationType.FILE_URI,
                            sourceType: Camera.PictureSourceType.PHOTOLIBRARY,
                            correctOrientation: true,
                            targetWidth: 320,
                            targetHeight: 320
        });
    }
        
                              
    function onPhotoDataSuccess(imageData)
    {
        var img = sessionStorage.getItem('usrImage');
                              
        sessionStorage.setItem(img,imageData);
                              //alert("imagedata "+imageData);
        function escapeShellArg (cmd) {
                return '\'' + cmd.replace(/\'/g, "'\\''") + '\'' ;
        }
        $("#imagePreview").css("background-image", "url("+escapeShellArg(imageData)+")");
        var imageToCompress = imageData ;
        // alert("imagedata: "+imageToCompress);
        imageToCompress.onload = function() {
                var canvas = document.createElement("canvas");
                new thumbnailer(canvas, imageData, 400, 8);
                //this produces lanczos3
                // but feel free to raise it up to 8. Your client will appreciate
                imageData = canvas;
        };
                                                        
        var win = function (r) {
                //alert("response from server is "+JSON.stringify(r));
                console.log("Code = " + r.responseCode);
                console.log("Response = " + r.response);
                console.log("Sent = " + r.bytesSent);
                var serverpath=JSON.parse(r.response)
                //  alert("Server path : "+serverpath.path);
                //sessionStorage.setItem('',serverpath.path);
        }
                                                        
        var fail = function (error) {
                // alert("error "+ JSON.stringify(error));
                console.log("upload error source " + error.source);
                console.log("upload error target " + error.target);
        }
        var oid= localStorage.getItem('oid');
        var options = new FileUploadOptions();
        //alert("options are "+JSON.stringify(options));
        options.fileKey = "fileToUpload";
        options.fileName = imageData.substr(imageData.lastIndexOf('/') + 1);
        options.mimeType = "image/jpg";
                                                        
        var params = new Object();
        params.oid = oid;
        options.params = params;
        var ft = new FileTransfer();
        ft.upload(imageData, encodeURI("http://in.shikshainfotech.com/FixIT/houseownerphotoupload.php?"), win, fail, options);
    }

                              
                              
        // ---------------------------IMAGE COMPRESSION Starts---------------------
        // returns a function that calculates lanczos weight
        function lanczosCreate(lobes) {
            return function(x) {
                if (x > lobes)
                return 0;
                x *= Math.PI;
                if (Math.abs(x) < 1e-16)
                return 1;
                var xx = x / lobes;
                return Math.sin(x) * Math.sin(xx) / x / xx;
            };
        }
    
    // elem: canvas element, img: image element, sx: scaled width, lobes: kernel radius
    function thumbnailer(elem, img, sx, lobes) {
        this.canvas = elem;
        elem.width = img.width;
        elem.height = img.height;
        elem.style.display = "none";
        this.ctx = elem.getContext("2d");
        this.ctx.drawImage(img, 0, 0);
        this.img = img;
        this.src = this.ctx.getImageData(0, 0, img.width, img.height);
        this.dest = {
            width : sx,
            height : Math.round(img.height * sx / img.width),
        };
        this.dest.data = new Array(this.dest.width * this.dest.height * 3);
        this.lanczos = lanczosCreate(lobes);
        this.ratio = img.width / sx;
        this.rcp_ratio = 2 / this.ratio;
        this.range2 = Math.ceil(this.ratio * lobes / 2);
        this.cacheLanc = {};
        this.center = {};
        this.icenter = {};
        setTimeout(this.process1, 0, this, 0);
    }
    
    thumbnailer.prototype.process1 = function(self, u) {
        self.center.x = (u + 0.5) * self.ratio;
        self.icenter.x = Math.floor(self.center.x);
        for (var v = 0; v < self.dest.height; v++) {
            self.center.y = (v + 0.5) * self.ratio;
            self.icenter.y = Math.floor(self.center.y);
            var a, r, g, b;
            a = r = g = b = 0;
            for (var i = self.icenter.x - self.range2; i <= self.icenter.x + self.range2; i++) {
                if (i < 0 || i >= self.src.width)
                continue;
                var f_x = Math.floor(1000 * Math.abs(i - self.center.x));
                if (!self.cacheLanc[f_x])
                self.cacheLanc[f_x] = {};
                for (var j = self.icenter.y - self.range2; j <= self.icenter.y + self.range2; j++) {
                    if (j < 0 || j >= self.src.height)
                    continue;
                    var f_y = Math.floor(1000 * Math.abs(j - self.center.y));
                    if (self.cacheLanc[f_x][f_y] == undefined)
                    self.cacheLanc[f_x][f_y] = self.lanczos(Math.sqrt(Math.pow(f_x * self.rcp_ratio, 2)
                                                                      + Math.pow(f_y * self.rcp_ratio, 2)) / 1000);
                                                                      weight = self.cacheLanc[f_x][f_y];
                                                                      if (weight > 0) {
                                                                          var idx = (j * self.src.width + i) * 4;
                                                                          a += weight;
                                                                          r += weight * self.src.data[idx];
                                                                          g += weight * self.src.data[idx + 1];
                                                                          b += weight * self.src.data[idx + 2];
                                                                      }
                }
            }
            var idx = (v * self.dest.width + u) * 3;
            self.dest.data[idx] = r / a;
            self.dest.data[idx + 1] = g / a;
            self.dest.data[idx + 2] = b / a;
        }
        
        if (++u < self.dest.width)
        setTimeout(self.process1, 0, self, u);
        else
        setTimeout(self.process2, 0, self);
    };
    thumbnailer.prototype.process2 = function(self) {
        self.canvas.width = self.dest.width;
        self.canvas.height = self.dest.height;
        self.ctx.drawImage(self.img, 0, 0, self.dest.width, self.dest.height);
        self.src = self.ctx.getImageData(0, 0, self.dest.width, self.dest.height);
        var idx, idx2;
        for (var i = 0; i < self.dest.width; i++) {
            for (var j = 0; j < self.dest.height; j++) {
                idx = (j * self.dest.width + i) * 3;
                idx2 = (j * self.dest.width + i) * 4;
                self.src.data[idx2] = self.dest.data[idx];
                self.src.data[idx2 + 1] = self.dest.data[idx + 1];
                self.src.data[idx2 + 2] = self.dest.data[idx + 2];
            }
        }
        self.ctx.putImageData(self.src, 0, 0);
        self.canvas.style.display = "block";
    };
    //-----------------------IMAGE COMPRESSION Ends--------------------------
        </script>

  </body>
</html>